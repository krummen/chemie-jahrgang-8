<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baukasten: Interaktive Herleitung CaCl₂ (Korrigierte Version)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6; color: #333; max-width: 800px; margin: 2rem auto;
            padding: 0 1rem; background-color: #f9f9f9;
        }
        h2 {
            color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;
        }
        .container {
            background-color: #ffffff; padding: 2rem; border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .info-block {
            background-color: #ecf0f1; border-left: 5px solid #3498db; padding: 15px;
            margin: 1rem 0; border-radius: 0 5px 5px 0;
        }
        .nav-btn {
            display: inline-block; background-color: #3498db; color: #ffffff; padding: 12px 25px;
            border-radius: 5px; text-decoration: none; font-size: 1.1em; border: none; cursor: pointer;
            margin-top: 1.5rem; transition: background-color 0.3s;
        }
        .nav-btn.secondary {
             background-color: #7f8c8d;
        }
        .nav-btn:hover:not(:disabled) { background-color: #2980b9; }
        .nav-btn.secondary:hover:not(:disabled) { background-color: #34495e; }
        .herleitung-step, .choice-container, .feedback-gif {
            display: none;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 1rem;
            text-align: center;
        }
        .feedback-gif { border: none; }
        .svg-drawing {
            width: 100%;
            max-width: 400px;
            min-height: 200px;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Interaktive Herleitung: Calciumchlorid (CaCl₂)</h2>
        <p class="info-block">Wir wollen die Summenformel für Calciumchlorid schrittweise herleiten, so wie beim Wasser-Beispiel.</p>
        
        <div id="cacl2-herleitung">
            <!-- Step 1 -->
            <div class="herleitung-step" id="step-1">
                <p>1. Wir starten mit den Wertigkeiten: Calcium (Ca) ist zweiwertig (2 Arme), Chlor (Cl) ist einwertig (1 Arm). Wir nehmen uns zunächst je ein Atom.</p>
                <div id="cacl2-step1-svg"></div>
            </div>
            
            <!-- Choice 1 -->
            <div class="choice-container" id="choice-1">
                <p>Was passiert, wenn wir diese beiden Atome verbinden?</p>
                <div class="button-wrapper">
                    <button class="nav-btn secondary" data-skip-feedback>Ich überlege selbst</button>
                    <button class="nav-btn" data-next-step="2">Zeig es mir</button>
                </div>
            </div>

            <!-- Step 2 -->
            <div class="herleitung-step" id="step-2">
                <p>2. Wir verbinden ein Chlor-Atom mit einem der Arme des Calciums. Es bleibt eine Bindungsstelle am Calcium-Atom frei. Das ist noch nicht stabil.</p>
                <div id="cacl2-step2-svg"></div>
            </div>

            <!-- Choice 2 -->
            <div class="choice-container" id="choice-2">
                 <p>Was ist der logische nächste Schritt?</p>
                <div class="button-wrapper">
                    <button class="nav-btn secondary" data-skip-feedback>Ich überlege selbst</button>
                    <button class="nav-btn" data-next-step="3">Nächsten Schritt anzeigen</button>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="herleitung-step" id="step-3">
                <p>3. Um die offene Bindungsstelle zu besetzen, holen wir uns ein zweites Chlor-Atom. Dessen Arm passt perfekt auf den freien Arm des Calciums.</p>
                <div id="cacl2-step3-svg"></div>
            </div>
            
            <!-- Choice 3 -->
            <div class="choice-container" id="choice-3">
                 <p>Bist du bereit für die endgültige Strukturformel?</p>
                <div class="button-wrapper">
                    <button class="nav-btn" data-next-step="final">Lösung anzeigen</button>
                </div>
            </div>

            <!-- Final Step -->
            <div class="herleitung-step" id="step-final">
                <p>4. Perfekt! Das zweite Chlor-Atom wird verbunden. Jetzt sind alle "Arme" besetzt und das Molekül ist fertig.</p>
                <div id="cacl2-final-svg"></div>
                <p class="info-block" style="margin-top: 2rem;">Wir haben 1 Calcium-Atom und 2 Chlor-Atome gebraucht. Die Summenformel lautet also: <strong>CaCl₂</strong>.</p>
            </div>

            <!-- Feedback GIF -->
            <div class="feedback-gif" id="skip-feedback-gif">
                 <div class="tenor-gif-embed" data-postid="9181333401381757341" data-share-method="host" data-aspect-ratio="1.04762" data-width="20%"></div>
            </div>
        </div>
        <button class="nav-btn" id="start-herleitung-btn">Herleitung starten</button>
    </div>
    <script type="text/javascript" async src="https://tenor.com/embed.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- SVG ENGINE (aus Ihren Beispielen) ---
    function drawAtomWithSymbol(symbol, radius, color = 'white', arms = 0, armAngles = []) {
        const fontSize = radius * 1.5;
        let armPaths = '';
        if (arms > 0) {
            const armLength = radius * 0.8;
            for (const angle of armAngles) {
                const x1 = radius;
                const x2 = radius + armLength;
                armPaths += `<line x1="${x1}" y1="0" x2="${x2}" y2="0" stroke="black" stroke-width="3" stroke-linecap="round" transform="rotate(${angle})"/>`;
            }
        }
        return `<g><circle cx="0" cy="0" r="${radius}" fill="${color}" stroke="black" stroke-width="2" /><text x="0" y="0" font-family="Arial, sans-serif" font-size="${fontSize}" font-weight="bold" text-anchor="middle" dy=".3em">${symbol}</text>${armPaths}</g>`;
    }
    
    // --- Definitionen (angelehnt an Wasser-Beispiel) ---
    const caAtomDef = { x: 200, y: 100, r: 25, color: '#95a5a6', armLength: 20, angles: [135, 225] };
    const clAtomDef = { r: 20, color: '#2ecc71', armLength: 16 };
    const distanceToCenter = caAtomDef.r + caAtomDef.armLength + 60 + clAtomDef.r + clAtomDef.armLength;
    const clAtomsCalculated = caAtomDef.angles.map(angle => ({
        center: {
            x: caAtomDef.x + distanceToCenter * Math.cos(angle * Math.PI / 180),
            y: caAtomDef.y + distanceToCenter * Math.sin(angle * Math.PI / 180)
        },
        armAngle: angle + 180
    }));
    const viewBox = `0 0 400 200`;

    // --- RENDER SVG for STEP 1 ---
    document.getElementById('cacl2-step1-svg').innerHTML = `<svg viewBox="${viewBox}" class="svg-drawing">
        <g transform="translate(${caAtomDef.x}, ${caAtomDef.y})">${drawAtomWithSymbol('Ca', caAtomDef.r, caAtomDef.color, 2, caAtomDef.angles)}</g>
        <g transform="translate(${clAtomsCalculated[0].center.x}, ${clAtomsCalculated[0].center.y})">${drawAtomWithSymbol('Cl', clAtomDef.r, clAtomDef.color, 1, [clAtomsCalculated[0].armAngle])}</g>
    </svg>`;
    
    // --- RENDER SVG for STEP 2 ---
    const final_cl1_distance = caAtomDef.r + clAtomDef.r + 5;
    const final_cl1_center = { 
        x: caAtomDef.x + final_cl1_distance * Math.cos(caAtomDef.angles[0] * Math.PI / 180), 
        y: caAtomDef.y + final_cl1_distance * Math.sin(caAtomDef.angles[0] * Math.PI / 180) 
    };
    document.getElementById('cacl2-step2-svg').innerHTML = `<svg viewBox="${viewBox}" class="svg-drawing">
        <!-- Verbundener Teil -->
        <g transform="translate(${caAtomDef.x}, ${caAtomDef.y})">
            <line x1="0" y1="0" x2="${final_cl1_center.x - caAtomDef.x}" y2="${final_cl1_center.y - caAtomDef.y}" stroke="black" stroke-width="3"/>
        </g>
        <g transform="translate(${final_cl1_center.x}, ${final_cl1_center.y})">${drawAtomWithSymbol('Cl', clAtomDef.r, clAtomDef.color)}</g>
        <!-- Calcium mit freiem Arm -->
        <g transform="translate(${caAtomDef.x}, ${caAtomDef.y})">
            ${drawAtomWithSymbol('Ca', caAtomDef.r, caAtomDef.color, 1, [caAtomDef.angles[1]])}
        </g>
         <text x="135" y="160" font-size="16" fill="red">Eine Bindung offen!</text>
    </svg>`;

    // --- RENDER SVG for STEP 3 ---
    document.getElementById('cacl2-step3-svg').innerHTML = `<svg viewBox="${viewBox}" class="svg-drawing">
        <!-- Bereits verbundener Teil -->
        <g transform="translate(${caAtomDef.x}, ${caAtomDef.y})">
             <line x1="0" y1="0" x2="${final_cl1_center.x - caAtomDef.x}" y2="${final_cl1_center.y - caAtomDef.y}" stroke="black" stroke-width="3"/>
        </g>
        <g transform="translate(${final_cl1_center.x}, ${final_cl1_center.y})">${drawAtomWithSymbol('Cl', clAtomDef.r, clAtomDef.color)}</g>
        <g transform="translate(${caAtomDef.x}, ${caAtomDef.y})">${drawAtomWithSymbol('Ca', caAtomDef.r, caAtomDef.color, 1, [caAtomDef.angles[1]])}</g>
        <!-- Neues Atom kommt hinzu -->
        <g transform="translate(${clAtomsCalculated[1].center.x}, ${clAtomsCalculated[1].center.y})">${drawAtomWithSymbol('Cl', clAtomDef.r, clAtomDef.color, 1, [clAtomsCalculated[1].armAngle])}</g>
        <text x="${(caAtomDef.x + clAtomsCalculated[1].center.x)/2 + 20}" y="${(caAtomDef.y + clAtomsCalculated[1].center.y)/2}" font-family="Arial, sans-serif" font-size="40" fill="#3498db" text-anchor="middle" dy=".3em">↔</text>
    </svg>`;
    
    // --- RENDER SVG for FINAL STEP ---
    const final_cl2_center = { 
        x: caAtomDef.x + final_cl1_distance * Math.cos(caAtomDef.angles[1] * Math.PI / 180), 
        y: caAtomDef.y + final_cl1_distance * Math.sin(caAtomDef.angles[1] * Math.PI / 180)
    };
    document.getElementById('cacl2-final-svg').innerHTML = `<svg viewBox="${viewBox}" class="svg-drawing">
        <g transform="translate(${caAtomDef.x}, ${caAtomDef.y})">
            <line x1="0" y1="0" x2="${final_cl1_center.x - caAtomDef.x}" y2="${final_cl1_center.y - caAtomDef.y}" stroke="black" stroke-width="3"/>
            <line x1="0" y1="0" x2="${final_cl2_center.x - caAtomDef.x}" y2="${final_cl2_center.y - caAtomDef.y}" stroke="black" stroke-width="3"/>
        </g>
        <g transform="translate(${caAtomDef.x}, ${caAtomDef.y})">${drawAtomWithSymbol('Ca', caAtomDef.r, caAtomDef.color)}</g>
        <g transform="translate(${final_cl1_center.x}, ${final_cl1_center.y})">${drawAtomWithSymbol('Cl', clAtomDef.r, clAtomDef.color)}</g>
        <g transform="translate(${final_cl2_center.x}, ${final_cl2_center.y})">${drawAtomWithSymbol('Cl', clAtomDef.r, clAtomDef.color)}</g>
    </svg>`;

    // --- INTERACTIVITY LOGIC ---
    const startBtn = document.getElementById('start-herleitung-btn');
    const steps = document.querySelectorAll('.herleitung-step');
    const choices = document.querySelectorAll('.choice-container');
    const feedbackGif = document.getElementById('skip-feedback-gif');
    
    startBtn.addEventListener('click', () => {
        startBtn.style.display = 'none';
        document.getElementById('step-1').style.display = 'block';
        document.getElementById('choice-1').style.display = 'block';
    });

    choices.forEach((choice) => {
        const nextStepBtn = choice.querySelector('[data-next-step]');
        const skipBtn = choice.querySelector('[data-skip-feedback]');

        if (nextStepBtn) {
            nextStepBtn.addEventListener('click', () => {
                const nextStepId = nextStepBtn.dataset.nextStep;
                choice.style.display = 'none';

                if (nextStepId === 'final') {
                    steps.forEach(s => s.style.display = 'none');
                    choices.forEach(c => c.style.display = 'none');
                    document.getElementById('step-final').style.display = 'block';
                } else {
                    document.getElementById(`step-${nextStepId}`).style.display = 'block';
                    document.getElementById(`choice-${nextStepId}`).style.display = 'block';
                }
            });
        }
        
        if (skipBtn) {
            skipBtn.addEventListener('click', () => {
                const parentChoice = skipBtn.closest('.choice-container');
                parentChoice.style.display = 'none';
                feedbackGif.style.display = 'block';
                setTimeout(() => {
                    feedbackGif.style.display = 'none';
                    parentChoice.style.display = 'block';
                }, 1500);
            });
        }
    });
});
</script>
</body>
</html>```